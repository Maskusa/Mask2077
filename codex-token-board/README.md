# Codex Token Board (без API)

Лёгкое расширение VS Code, которое **читает логи сессий** (JSONL/JLOG/LOG) от Codex/IDE и показывает **табло токенов**: `INPUT / CACHED / OUTPUT`. Никакого API‑ключа не требуется.

> ⚠️ Требование: у вас должны писаться **журналы/сессии** Codex (или IDE, которая его использует) в файлы с JSON‑событиями, где присутствует объект `usage` (как минимум `input_tokens`/`prompt_tokens`, `output_tokens`/`completion_tokens`, и `…cached_tokens`). Расширение не внедряется в Codex — оно лишь читает эти файлы из выбранной папки.

## Что умеет
- Большие счётчики **INPUT / CACHED / OUTPUT**.
- Сводка **по дням** и **по моделям**.
- **Лента последних событий** (с кликом, чтобы открыть исходный лог).
- Статус‑бар с суммой.
- **Экспорт CSV** (все события).
- Работает **без API**, только по логам, в т.ч. для аккаунтов ChatGPT Plus.

## Установка локально
1. Скачайте архив проекта и распакуйте, либо клонируйте репозиторий в папку:
   ```bash
   cd PATH/TO
   unzip codex-token-board.zip -d codex-token-board
   cd codex-token-board
   ```
2. Установите зависимости и соберите расширение:
   ```bash
   npm install
   npm run compile
   ```
3. Запустите VS Code в режиме разработки (нажатие `F5`) **или** установите расширение локально:
   ```bash
   # Для разработки:
   # откроется новое окно 'Extension Development Host'
   # В нём в панели Explorer появится 'Token Board'.

   # Для паковки VSIX (опционально):
   npm run package
   # затем установите через VS Code: Extensions → “Install from VSIX…”
   ```

## Первичная настройка
1. Убедитесь, что Codex/IDE **записывает логи** в файлы (JSONL/JLOG/LOG) с полем `usage`. Если логи выключены — включите их и укажите папку вывода (конкретные шаги зависят от вашей сборки/плагина).
2. В VS Code запустите команду **`Token Board: Select Log Folder`** и выберите **папку, где лежат логи сессий**.
3. Откройте панель **Explorer → Token Board**. Если хотите перечитать всю историю логов — оставьте включённым `codexTokenBoard.parseHistoryOnStart` (по умолчанию **вкл.**).

> Поддерживаются файлы, соответствующие глобу `**/*.{jsonl,log,jlog,json}` (настраивается `codexTokenBoard.fileGlob`).

## Как это работает
- Расширение **периодически опрашивает** (по умолчанию каждую секунду) выбранную папку и **догружает новые строки** из файлов.
- Оно ищет в каждой JSON‑строке объект `usage` **в любом уровне вложенности**, достаёт:
  - `input_tokens` **или** `prompt_tokens` → **INPUT**
  - `output_tokens` **или** `completion_tokens` → **OUTPUT**
  - `input_tokens_details.cached_tokens` **или** `prompt_tokens_details.cached_tokens` → **CACHED**
- Дополнительно вытаскивает `model` и временную метку (`created`/`timestamp`/ISO‑строка), чтобы строить сводки.

## Полезные команды
- **Token Board: Select Log Folder** — выбрать папку логов.
- **Token Board: Rebuild (Re-scan all logs)** — перечитать историю (если вы почистили/переложили файлы).
- **Token Board: Reset Stats** — обнулить накопленные значения (не трогает файлы).
- **Token Board: Export CSV** — выгрузить все найденные события в CSV.
- **Token Board: Open Extension Settings** — перейти к настройкам расширения.

## Настройки
- `codexTokenBoard.logFolder` — папка с логами (обязательно).
- `codexTokenBoard.fileGlob` — шаблон поиска файлов внутри папки.
- `codexTokenBoard.parseHistoryOnStart` — читать историю при старте (true).
- `codexTokenBoard.pollIntervalMs` — период опроса в мс (1000).

## Частые вопросы
**Ничего не считает.**  
Проверьте, что выбранная папка действительно содержит **JSON‑логи с полем `usage`** и в них появляются новые строки при обращениях к Codex/IDE. Если поле `usage` отсутствует — расширению нечего парсить.

**А где взять сами логи?**  
Это зависит от вашей сборки Codex/IDE. Включите запись сессий/трассировки и направьте вывод в папку, которую вы затем укажете расширению.

**Показывает странные числа.**  
Помните, что IDE может добавлять **дополнительный скрытый контекст**, пересобирать запросы и использовать **prompt caching**. Мы считаем **ровно то, что написано в `usage`** ваших логов.

---

MIT © You